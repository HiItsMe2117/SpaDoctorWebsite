<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dashboard - Spa Doctors</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/analytics.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">Spa Doctors</a>
                <a href="tel:+18562667293" class="phone-header">üìû (856) 266-7293</a>
                <div class="mobile-menu" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <nav id="nav">
                    <ul>
                        <li><a href="/services">Services</a></li>
                        <li><a href="/service-areas">Service Areas</a></li>
                        <li><a href="/gallery">Gallery</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/contact">Contact</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/dashboard" class="active">Dashboard</a></li>
                        <li><a href="/admin/blog" style="background: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 5px;">üîß Blog Admin</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>Business Dashboard</h1>
                <p>Manage your business analytics, media content, and social media presence all in one place.</p>
                <button onclick="refreshData()" class="cta-button">Refresh Data</button>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <!-- Dashboard Tab Navigation -->
                <div class="dashboard-tabs">
                    <button class="tab-button active" onclick="switchTab('analytics', this)">
                        üìä Analytics
                    </button>
                    <button class="tab-button" onclick="switchTab('media', this)">
                        üì∏ Media Manager
                    </button>
                    <button class="tab-button" onclick="switchTab('social', this)">
                        üì± Social Posts
                    </button>
                    <button class="tab-button" onclick="switchTab('settings', this)">
                        ‚öôÔ∏è Settings
                    </button>
                </div>

                <!-- Analytics Tab Content -->
                <div id="analytics-tab" class="tab-content active">
                    <h2 style="color: var(--gray-dark); margin-bottom: 2rem; font-size: 2rem;">üìä Business Analytics</h2>
                    
                    <!-- Key Metrics Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
                        <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                            <div style="color: var(--primary-blue); font-size: 2.5rem; margin-bottom: 0.5rem;">üìû</div>
                            <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Total Contacts</h3>
                            <div id="total-contacts" style="font-size: 2.5rem; font-weight: bold; color: var(--gray-dark);">0</div>
                            <p style="color: var(--gray-medium); margin-top: 0.5rem;">Customer inquiries</p>
                        </div>
                        
                        <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                            <div style="color: var(--primary-blue); font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
                            <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Blog Views</h3>
                            <div id="total-blog-views" style="font-size: 2.5rem; font-weight: bold; color: var(--gray-dark);">0</div>
                            <p style="color: var(--gray-medium); margin-top: 0.5rem;">Page visits</p>
                        </div>
                        
                        <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                            <div style="color: var(--primary-blue); font-size: 2.5rem; margin-bottom: 0.5rem;">üìñ</div>
                            <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">Article Reads</h3>
                            <div id="total-expansions" style="font-size: 2.5rem; font-weight: bold; color: var(--gray-dark);">0</div>
                            <p style="color: var(--gray-medium); margin-top: 0.5rem;">Engagements</p>
                        </div>
                    </div>
                    
                    <!-- Service Analytics -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                        <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: var(--gray-dark); margin-bottom: 1.5rem; font-size: 1.3rem;">üîß Service Requests</h3>
                            <div id="service-requests">
                                <!-- Dynamic service request data will load here -->
                            </div>
                        </div>
                        
                        <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: var(--gray-dark); margin-bottom: 1.5rem; font-size: 1.3rem;">üìÖ Recent Activity</h3>
                            <div style="border-bottom: 1px solid var(--gray-light); padding: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="color: var(--gray-dark); margin-bottom: 0.3rem;">New Contact Form</h4>
                                        <p style="color: var(--gray-medium); font-size: 0.9rem;">Hot tub repair inquiry</p>
                                    </div>
                                    <span style="color: var(--gray-medium); font-size: 0.8rem;">2 hours ago</span>
                                </div>
                            </div>
                            <div style="border-bottom: 1px solid var(--gray-light); padding: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="color: var(--gray-dark); margin-bottom: 0.3rem;">Blog Article View</h4>
                                        <p style="color: var(--gray-medium); font-size: 0.9rem;">Winter maintenance tips</p>
                                    </div>
                                    <span style="color: var(--gray-medium); font-size: 0.8rem;">4 hours ago</span>
                                </div>
                            </div>
                            <div style="padding: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="color: var(--gray-dark); margin-bottom: 0.3rem;">Phone Call</h4>
                                        <p style="color: var(--gray-medium); font-size: 0.9rem;">Cleaning service booking</p>
                                    </div>
                                    <span style="color: var(--gray-medium); font-size: 0.8rem;">6 hours ago</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Manager Tab Content -->
                <div id="media-tab" class="tab-content">
                    <h2 style="color: var(--gray-dark); margin-bottom: 2rem; font-size: 2rem;">üì∏ Media Manager</h2>
                    
                    <!-- Google Business Profile section removed (API access denied) -->
                    
                    <!-- Upload Section -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.3rem;">Upload New Media (Local Storage)</h3>
                        <div style="border: 2px dashed var(--primary-blue); border-radius: 10px; padding: 3rem; text-align: center; background: var(--gray-light); transition: all 0.3s ease;">
                            <div style="color: var(--primary-blue); font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                            <h4 style="color: var(--gray-dark); margin-bottom: 1rem;">Drag & drop files here</h4>
                            <p style="color: var(--gray-medium); margin-bottom: 1.5rem;">Or click to browse your computer</p>
                            <button style="background: var(--primary-blue); color: var(--white); border: none; padding: 0.8rem 2rem; border-radius: 5px; font-weight: 500; cursor: pointer; transition: background 0.3s ease;">Choose Files</button>
                            <p style="color: var(--gray-medium); font-size: 0.9rem; margin-top: 1rem;">Supports: JPG, PNG, GIF, MP4, MOV (Max 10MB per file)</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;">
                            <input type="text" placeholder="Title (optional)" style="padding: 0.8rem; border: 2px solid var(--gray-light); border-radius: 5px; font-family: inherit;">
                            <input type="text" placeholder="Tags (comma separated)" style="padding: 0.8rem; border: 2px solid var(--gray-light); border-radius: 5px; font-family: inherit;">
                        </div>
                    </div>

                    <!-- Media Library -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.3rem;">Media Library</h3>
                        
                        <!-- Filter Controls -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; align-items: center;">
                            <select style="padding: 0.5rem; border: 2px solid var(--gray-light); border-radius: 5px; color: var(--gray-dark);">
                                <option>All Media</option>
                                <option>Images</option>
                                <option>Videos</option>
                            </select>
                            <input type="text" placeholder="Search media..." style="padding: 0.5rem; border: 2px solid var(--gray-light); border-radius: 5px; flex: 1;">
                        </div>
                        
                        <!-- Media Grid (Dynamic) -->
                        <div id="media-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                            <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--gray-medium); background: var(--gray-light); border-radius: 8px;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                <h4 style="color: var(--gray-dark); margin-bottom: 1rem;">No Media Uploaded Yet</h4>
                                <p style="margin-bottom: 1.5rem;">Upload photos and videos above to build your media library!</p>
                                <p style="font-size: 0.9rem;">Media files will be organized and accessible for social media posts.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Social Posts Tab Content -->
                <div id="social-tab" class="tab-content">
                    <h2 style="color: var(--gray-dark); margin-bottom: 2rem; font-size: 2rem;">üì± Social Media Posts</h2>
                    
                    <!-- Create New Post -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.3rem;">Create New Post</h3>
                        <div style="display: grid; gap: 1.5rem;">
                            <textarea placeholder="What's happening at Spa Doctors today?" style="min-height: 120px; padding: 1rem; border: 2px solid var(--gray-light); border-radius: 8px; resize: vertical; font-family: inherit; line-height: 1.5;"></textarea>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--gray-dark);">Attach Media</label>
                                    <div style="display: grid; gap: 0.5rem;">
                                        <input type="file" accept="image/*,video/*" capture="environment" style="width: 100%; padding: 0.8rem; border: 2px solid var(--gray-light); border-radius: 5px; color: var(--gray-dark); cursor: pointer;" placeholder="Choose from camera roll or files">
                                        <div style="display: flex; gap: 0.5rem; font-size: 0.8rem; color: var(--gray-medium);">
                                            <span>üì∑ Camera Roll</span>
                                            <span>‚Ä¢</span>
                                            <span>üìÅ Device Files</span>
                                            <span>‚Ä¢</span>
                                            <span>üé• Videos OK</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--gray-dark);">Post to Platforms</label>
                                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; padding: 0.8rem; border: 2px solid var(--gray-light); border-radius: 5px;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--gray-dark);">
                                            <input type="checkbox" checked style="accent-color: var(--primary-blue);"> üè¢ Google Business
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--gray-dark);">
                                            <input type="checkbox" checked style="accent-color: var(--primary-blue);"> üìò Facebook
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--gray-dark);">
                                            <input type="checkbox" checked style="accent-color: var(--primary-blue);"> üì∑ Instagram
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <button onclick="createSocialPost()" style="background: var(--primary-blue); color: var(--white); border: none; padding: 0.8rem 2rem; border-radius: 5px; font-weight: 500; cursor: pointer; transition: background 0.3s ease;">üì§ Post Now</button>
                                <button onclick="schedulePost()" style="background: var(--gray-medium); color: var(--white); border: none; padding: 0.8rem 2rem; border-radius: 5px; font-weight: 500; cursor: pointer; transition: background 0.3s ease;">‚è∞ Schedule Post</button>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Posts -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.3rem;">Recent Posts</h3>
                        
                        <!-- Recent Posts (Dynamic) -->
                        <div id="recent-posts-container" style="display: grid; gap: 1.5rem;">
                            <div style="text-align: center; padding: 3rem; color: var(--gray-medium); background: var(--gray-light); border-radius: 8px;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
                                <h4 style="color: var(--gray-dark); margin-bottom: 1rem;">No Social Media Posts Yet</h4>
                                <p style="margin-bottom: 1.5rem;">Create your first social media post above to see it appear here!</p>
                                <p style="font-size: 0.9rem;">Posts will show engagement metrics and platform status once created.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab Content -->
                <div id="settings-tab" class="tab-content">
                    <h2 style="color: var(--gray-dark); margin-bottom: 2rem; font-size: 2rem;">‚öôÔ∏è Business Settings</h2>
                    
                    <!-- Social Media Connections -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>üîó</span> Social Media Connections
                        </h3>
                        
                        <div style="display: grid; gap: 1rem;">
                            <div class="google-connection-status" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--gray-light); border-radius: 8px; border-left: 4px solid var(--gray-medium);">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">üè¢</span>
                                    <div>
                                        <h4 style="color: var(--gray-dark); margin-bottom: 0.2rem;">Google Business Profile</h4>
                                        <p style="color: var(--gray-medium); font-size: 0.9rem; margin: 0;">Ready to connect</p>
                                    </div>
                                </div>
                                <button onclick="alert('Google Business Profile integration removed (API access denied)')" style="background: var(--gray-medium); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">Unavailable</button>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--gray-light); border-radius: 8px; border-left: 4px solid var(--gray-medium);">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">üìò</span>
                                    <div>
                                        <h4 style="color: var(--gray-dark); margin-bottom: 0.2rem;">Facebook Business</h4>
                                        <p style="color: var(--gray-medium); font-size: 0.9rem; margin: 0;">Ready to connect</p>
                                    </div>
                                </div>
                                <button onclick="connectFacebook()" style="background: var(--primary-blue); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">Connect</button>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--gray-light); border-radius: 8px; border-left: 4px solid var(--gray-medium);">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">üì∑</span>
                                    <div>
                                        <h4 style="color: var(--gray-dark); margin-bottom: 0.2rem;">Instagram Business</h4>
                                        <p style="color: var(--gray-medium); font-size: 0.9rem; margin: 0;">Ready to connect</p>
                                    </div>
                                </div>
                                <button onclick="connectInstagram()" style="background: var(--primary-blue); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">Connect</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- General Settings -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>‚öôÔ∏è</span> Post Settings
                        </h3>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; color: var(--gray-dark); font-weight: 500; margin-bottom: 0.5rem;">Default Post Template:</label>
                            <textarea style="width: 100%; height: 100px; padding: 1rem; border: 2px solid var(--gray-light); border-radius: 8px; font-family: inherit; resize: vertical; color: var(--gray-dark);" placeholder="Enter your default social media post template...">#HotTubRepair #DenverServices #SpaExperts

Call (856) 266-7293 for professional hot tub service!</textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--gray-dark);">
                                <input type="checkbox" style="transform: scale(1.2);" checked>
                                Auto-add contact info
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--gray-dark);">
                                <input type="checkbox" style="transform: scale(1.2);" checked>
                                Include website link
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--gray-dark);">
                                <input type="checkbox" style="transform: scale(1.2);">
                                Send notifications
                            </label>
                        </div>
                        
                        <button style="background: var(--primary-blue); color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: background 0.3s ease;" onmouseover="this.style.background='var(--dark-blue)'" onmouseout="this.style.background='var(--primary-blue)'">
                            üíæ Save Settings
                        </button>
                    </div>
                    
                    <!-- Account Settings -->
                    <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>üë§</span> Account Settings
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <div>
                                <h4 style="color: var(--gray-dark); margin-bottom: 1rem;">Business Information</h4>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--gray-dark); font-weight: 500; margin-bottom: 0.3rem;">Business Name:</label>
                                    <input type="text" value="Spa Doctors" style="width: 100%; padding: 0.8rem; border: 2px solid var(--gray-light); border-radius: 5px; color: var(--gray-dark);">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--gray-dark); font-weight: 500; margin-bottom: 0.3rem;">Phone Number:</label>
                                    <input type="tel" value="(856) 266-7293" style="width: 100%; padding: 0.8rem; border: 2px solid var(--gray-light); border-radius: 5px; color: var(--gray-dark);">
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="color: var(--gray-dark); margin-bottom: 1rem;">Data Management</h4>
                                <button style="background: var(--gray-medium); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; margin-right: 1rem; margin-bottom: 0.5rem;">üìä Export Analytics</button>
                                <button style="background: var(--gray-medium); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; margin-bottom: 0.5rem;">üóëÔ∏è Clear Data</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Spa Doctors</h4>
                    <p>Professional hot tub repair, maintenance, transport, and cleaning services. Fully insured and experienced.</p>
                </div>
                <div class="footer-section">
                    <h4>Analytics</h4>
                    <p>Blog Performance Tracking</p>
                    <p>Customer Engagement Metrics</p>
                    <p>Content Optimization</p>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <p><a href="tel:+18562667293">üìû (856) 266-7293</a></p>
                    <p>Data-Driven Service</p>
                    <p>Professional Excellence</p>
                </div>
            </div>
            <p>&copy; 2024 Spa Doctors. All rights reserved.</p>
        </div>
    </footer>

    <script>
        console.log('Dashboard script started loading...');

        function toggleMenu() {
            const nav = document.getElementById('nav');
            nav.classList.toggle('active');
        }

        async function loadAnalytics() {
            try {
                const response = await fetch('/analytics-data');
                const data = await response.json();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('analytics-content').style.display = 'block';

                // Update overall stats
                document.getElementById('total-contacts').textContent = data.summary.totalContacts;
                document.getElementById('total-blog-views').textContent = data.summary.totalBlogViews;

                const totalExpansions = Object.values(data.summary.articleStats)
                    .reduce((sum, article) => sum + article.totalExpansions, 0);
                document.getElementById('total-expansions').textContent = totalExpansions;

                // Update service requests
                const serviceRequestsDiv = document.getElementById('service-requests');
                serviceRequestsDiv.innerHTML = '';

                if (Object.keys(data.summary.serviceRequests).length === 0) {
                    serviceRequestsDiv.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">No service requests yet. Contact forms will show data here!</p>';
                } else {
                    Object.entries(data.summary.serviceRequests).forEach(([service, stats]) => {
                        const serviceDiv = document.createElement('div');
                        serviceDiv.style.cssText = 'border-left: 4px solid #2563eb; padding: 1rem; margin-bottom: 1rem; background: #f8fafc;';

                        const topReferrer = Object.entries(stats.referrerPages)
                            .sort(([,a], [,b]) => b - a)[0]?.[0] || 'unknown';

                        serviceDiv.innerHTML = `
                            <h4 style="color: #334155; margin-bottom: 0.5rem;">${service}</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; color: #64748b; font-size: 0.9rem;">
                                <span><strong>${stats.count}</strong> requests</span>
                                <span><strong>${stats.hasPhoneCount}</strong> with phone</span>
                                <span><strong>${stats.hasEmailCount}</strong> with email</span>
                                <span>From: <strong>${topReferrer}</strong></span>
                            </div>
                        `;
                        serviceRequestsDiv.appendChild(serviceDiv);
                    });
                }

                // Update contact trends
                const contactTrendsDiv = document.getElementById('contact-trends');
                contactTrendsDiv.innerHTML = '';

                if (Object.keys(data.summary.contactTrends).length === 0) {
                    contactTrendsDiv.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">No contact trends yet.</p>';
                } else {
                    const sortedDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                    sortedDays.forEach(day => {
                        const count = data.summary.contactTrends[day] || 0;
                        if (count > 0) {
                            const dayDiv = document.createElement('div');
                            dayDiv.style.cssText = 'display: flex; justify-content: space-between; padding: 0.5rem 1rem; margin-bottom: 0.5rem; background: #f8fafc; border-radius: 5px;';
                            dayDiv.innerHTML = `
                                <span style="color: #334155;">${day}</span>
                                <span style="color: #2563eb; font-weight: bold;">${count} contacts</span>
                            `;
                            contactTrendsDiv.appendChild(dayDiv);
                        }
                    });
                }

                // Update article stats
                const articleStatsDiv = document.getElementById('article-stats');
                articleStatsDiv.innerHTML = '';

                if (Object.keys(data.summary.articleStats).length === 0) {
                    articleStatsDiv.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">No article interactions yet. Visit your blog and click "Read More" to see data here!</p>';
                } else {
                    Object.entries(data.summary.articleStats).forEach(([title, stats]) => {
                        const articleDiv = document.createElement('div');
                        articleDiv.style.cssText = 'border-left: 4px solid #2563eb; padding: 1rem; margin-bottom: 1rem; background: #f8fafc;';

                        const lastRead = stats.lastExpanded ? new Date(stats.lastExpanded).toLocaleDateString() : 'Never';

                        articleDiv.innerHTML = `
                            <h4 style="color: #334155; margin-bottom: 0.5rem;">${title}</h4>
                            <div style="display: flex; gap: 2rem; color: #64748b;">
                                <span><strong>${stats.totalExpansions}</strong> reads</span>
                                <span>Last read: <strong>${lastRead}</strong></span>
                            </div>
                        `;
                        articleStatsDiv.appendChild(articleDiv);
                    });
                }

                // Update daily blog views
                const dailyViewsDiv = document.getElementById('daily-views');
                dailyViewsDiv.innerHTML = '';

                if (Object.keys(data.rawData.blogPageViews).length === 0) {
                    dailyViewsDiv.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">No blog views recorded yet.</p>';
                } else {
                    Object.entries(data.rawData.blogPageViews).forEach(([date, views]) => {
                        const dayDiv = document.createElement('div');
                        dayDiv.style.cssText = 'display: flex; justify-content: space-between; padding: 0.5rem 1rem; margin-bottom: 0.5rem; background: #f8fafc; border-radius: 5px;';
                        dayDiv.innerHTML = `
                            <span style="color: #334155;">${new Date(date).toLocaleDateString()}</span>
                            <span style="color: #2563eb; font-weight: bold;">${views} blog views</span>
                        `;
                        dailyViewsDiv.appendChild(dayDiv);
                    });
                }

            } catch (error) {
                document.getElementById('loading').innerHTML = '<p style="color: #ef4444;">Error loading analytics data. Please try again.</p>';
                console.error('Analytics error:', error);
            }
        }

        function refreshData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('analytics-content').style.display = 'none';
            loadAnalytics();
        }

        // Tab switching functionality
        function switchTab(tabName, buttonElement) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show the selected tab
            document.getElementById(tabName + '-tab').classList.add('active');

            // Add active class to clicked button
            buttonElement.classList.add('active');

            // Load data based on tab
            if (tabName === 'analytics') {
                loadAnalytics();
            } else if (tabName === 'media') {
                checkGoogleConnectionStatus();
            } else if (tabName === 'social') {
                loadRecentPosts();
            }
        }

        // Media upload functionality
        function handleFileSelect(input) {
            const files = input.files;
            const dropZoneContent = document.getElementById('dropZoneContent');

            if (files.length > 0) {
                dropZoneContent.innerHTML = `
                    <p style="color: #2563eb; margin-bottom: 1rem; font-size: 1.1rem;">üìÅ ${files.length} file(s) selected</p>
                    <p style="color: #64748b; font-size: 0.9rem;">Click "Upload Media" below to process files</p>
                `;
            }
        }

        // Load media library - DISABLED (using hardcoded content)
        async function loadMediaLibrary() {
            console.log('Media library loading disabled - using hardcoded content');
        }

        // Load media options for social posts - DISABLED (using hardcoded content)
        async function loadMediaForSocial() {
            console.log('Media for social loading disabled - using hardcoded content');
        }

        // Load recent social posts from API
        async function loadRecentPosts() {
            try {
                const response = await fetch('/social-posts');
                const posts = await response.json();
                
                const container = document.getElementById('recent-posts-container');
                
                if (posts.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--gray-medium); background: var(--gray-light); border-radius: 8px;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
                            <h4 style="color: var(--gray-dark); margin-bottom: 1rem;">No Social Media Posts Yet</h4>
                            <p style="margin-bottom: 1.5rem;">Create your first social media post above to see it appear here!</p>
                            <p style="font-size: 0.9rem;">Posts will show engagement metrics and platform status once created.</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = posts.map(post => {
                        const postDate = new Date(post.createdAt).toLocaleDateString();
                        const platformBadges = post.platforms.map(platform => {
                            const platformInfo = {
                                google: { icon: 'üè¢', name: 'Google Business' },
                                facebook: { icon: 'üìò', name: 'Facebook' },
                                instagram: { icon: 'üì∑', name: 'Instagram' }
                            };
                            const info = platformInfo[platform] || { icon: 'üì±', name: platform };
                            return `<span style="background: var(--white); color: var(--primary-blue); padding: 0.3rem 0.7rem; border-radius: 15px; font-size: 0.8rem; font-weight: 500;">${info.icon} ${info.name}</span>`;
                        }).join('');
                        
                        const statusInfo = post.status === 'published' 
                            ? { color: 'var(--primary-blue)', text: '‚úÖ Published Successfully' }
                            : { color: '#f59e0b', text: '‚è∞ Scheduled' };
                            
                        return `
                            <div style="border-left: 4px solid var(--primary-blue); padding: 1.5rem; background: var(--gray-light); border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                    <h4 style="margin: 0; color: var(--gray-dark); line-height: 1.4;">${post.content}</h4>
                                    <span style="color: var(--gray-medium); font-size: 0.8rem; white-space: nowrap; margin-left: 1rem;">${postDate}</span>
                                </div>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                    ${platformBadges}
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: ${statusInfo.color}; font-size: 0.9rem; font-weight: 500;">${statusInfo.text}</span>
                                    <span style="color: var(--gray-medium); font-size: 0.8rem;">${post.analytics?.views || 0} views</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('Error loading recent posts:', error);
                document.getElementById('recent-posts-container').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        <p>Error loading recent posts. Please try again.</p>
                    </div>
                `;
            }
        }

        // Google integration functions removed (API access denied)

        function connectFacebook() {
            alert('Facebook integration coming soon! This will allow you to post to your business page.');
        }

        function connectInstagram() {
            alert('Instagram integration coming soon! This will allow you to post photos and videos.');
        }

        // Create social media post
        async function createSocialPost() {
            // Get form data
            const socialTab = document.getElementById('social-tab');
            const textarea = socialTab.querySelector('textarea');
            const fileInput = socialTab.querySelector('input[type="file"]');
            const platformCheckboxes = socialTab.querySelectorAll('input[type="checkbox"]:checked');
            
            const content = textarea.value.trim();
            if (!content) {
                alert('Please enter some content for your post!');
                return;
            }
            
            // Get selected platforms
            const platforms = Array.from(platformCheckboxes).map(cb => {
                const label = cb.parentElement.textContent.trim();
                if (label.includes('Google')) return 'google';
                if (label.includes('Facebook')) return 'facebook';
                if (label.includes('Instagram')) return 'instagram';
                return null;
            }).filter(p => p);
            
            if (platforms.length === 0) {
                alert('Please select at least one platform to post to!');
                return;
            }
            
            // Prepare data
            let requestBody;
            let requestHeaders = { 'Content-Type': 'application/json' };
            
            // Debug logging
            console.log('Sending data:', {
                content: content,
                platforms: platforms,
                platformsJSON: JSON.stringify(platforms)
            });
            
            // Check if file is selected
            if (fileInput.files.length > 0) {
                // Use FormData for file upload
                const formData = new FormData();
                formData.append('content', content);
                formData.append('platforms', JSON.stringify(platforms));
                formData.append('mediaFile', fileInput.files[0]);
                requestBody = formData;
                requestHeaders = {}; // Let browser set content-type for FormData
            } else {
                // Use JSON for text-only posts
                requestBody = JSON.stringify({
                    content: content,
                    platforms: platforms
                });
            }
            
            // Show loading state
            const postButton = event.target;
            const originalText = postButton.textContent;
            postButton.textContent = '‚è≥ Posting...';
            postButton.disabled = true;
            
            try {
                const response = await fetch('/create-social-post', {
                    method: 'POST',
                    headers: requestHeaders,
                    body: requestBody
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let successMessage = '‚úÖ Post created successfully!\n\n';
                    
                    // Check if Google Business Profile requires manual action
                    if (result.results && result.results.google && result.results.google.requiresManualAction) {
                        successMessage += `üì± ${platforms.filter(p => p !== 'google').join(', ')}: Posted automatically\n`;
                        successMessage += `üè¢ Google Business Profile: Authentication verified\n`;
                        successMessage += `üìã Manual posting required at business.google.com\n\n`;
                        successMessage += `Content ready to copy: "${result.post.content}"`;
                    } else {
                        successMessage += `Posted to: ${platforms.join(', ')}\n`;
                        successMessage += `Engagement tracking activated.`;
                    }
                    
                    alert(successMessage);
                    
                    // Clear form
                    textarea.value = '';
                    fileInput.value = '';
                    
                    // Refresh recent posts (in real implementation)
                    console.log('Post created:', result.post);
                } else {
                    alert('‚ùå Failed to create post: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('‚ùå Error creating post: ' + error.message);
                console.error('Post creation error:', error);
            } finally {
                // Restore button state
                postButton.textContent = originalText;
                postButton.disabled = false;
            }
        }

        function schedulePost() {
            alert('Post scheduling feature coming soon! This will allow you to schedule posts for optimal times.');
        }

        // Get user-friendly category labels
        function getCategoryLabel(category) {
            const labels = {
                'COVER': 'Cover Photo',
                'PROFILE': 'Profile Photo',
                'LOGO': 'Logo',
                'EXTERIOR': 'Exterior',
                'INTERIOR': 'Interior',
                'PRODUCT': 'Products/Services',
                'AT_WORK': 'Team at Work',
                'FOOD_AND_DRINK': 'Food & Drink',
                'MENU': 'Menu',
                'COMMON_AREA': 'Common Area',
                'ROOMS': 'Rooms',
                'TEAMS': 'Team Photos',
                'ADDITIONAL': 'Additional Photos'
            };
            return labels[category] || category;
        }

        // Check Google connection status and update UI
        async function checkGoogleConnectionStatus() {
            try {
                const response = await fetch('/social-settings');
                const result = await response.json();

                if (result.google && result.google.connected) {
                    // Check if setup is required (fallback location)
                    if (result.google.businessLocations && result.google.businessLocations.length > 0) {
                        const location = result.google.businessLocations[0];
                        
                        if (location.setupRequired || location.fallback) {
                            // Show setup required UI
                            document.getElementById('google-not-connected').style.display = 'none';
                            document.getElementById('google-setup-required').style.display = 'block';
                            document.getElementById('google-connected').style.display = 'none';
                            
                            // Update settings UI if it exists
                            // Google connection status update removed
                        } else {
                            // Show connected UI
                            document.getElementById('google-not-connected').style.display = 'none';
                            document.getElementById('google-setup-required').style.display = 'none';
                            document.getElementById('google-connected').style.display = 'block';
                            
                            // Google Business Profile media loading removed (API access denied)
                        }
                    } else {
                        // No locations found, show setup required
                        document.getElementById('google-not-connected').style.display = 'none';
                        document.getElementById('google-setup-required').style.display = 'block';
                        document.getElementById('google-connected').style.display = 'none';
                        
                        // Google connection status update removed
                    }
                } else {
                    // Show disconnected UI
                    document.getElementById('google-not-connected').style.display = 'block';
                    document.getElementById('google-setup-required').style.display = 'none';
                    document.getElementById('google-connected').style.display = 'none';
                    
                    // Update settings UI if it exists
                    // Google connection status update removed
                }
            } catch (error) {
                console.error('Error checking Google connection status:', error);
                // Default to disconnected state
                document.getElementById('google-not-connected').style.display = 'block';
                document.getElementById('google-setup-required').style.display = 'none';
                document.getElementById('google-connected').style.display = 'none';
            }
        }

        // Check for connection success/error messages from URL
        function checkUrlMessages() {
            const urlParams = new URLSearchParams(window.location.search);
            const googleConnected = urlParams.get('google_connected');

            if (googleConnected === 'success') {
                alert('Google Business Profile connected successfully!');
                // Google connection status update removed
                // Remove the parameter from URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (googleConnected === 'error') {
                alert('Failed to connect Google Business Profile. Please try again.');
                // Remove the parameter from URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Initialize dashboard data
        function initializeDashboard() {
            console.log('Initializing dashboard...');

            // Load analytics when page loads
            loadAnalytics();

            // Check for URL messages
            checkUrlMessages();
        }

        // Check if DOM is already loaded, otherwise wait for DOMContentLoaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM Content Loaded event fired');
                initializeDashboard();
            });
        } else {
            console.log('DOM already ready, initializing immediately');
            initializeDashboard();
        }

        // Form submissions
        document.addEventListener('DOMContentLoaded', function() {
            // Note: Forms are now static mockups, so no event listeners needed

            /*
            // Media upload form
            document.getElementById('mediaUploadForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const formData = new FormData(this);

                try {
                    const response = await fetch('/upload-media', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert('Media uploaded successfully!');
                        this.reset();
                        document.getElementById('dropZoneContent').innerHTML = `
                            <p style="color: #64748b; margin-bottom: 1rem; font-size: 1.1rem;">üìÅ Click to upload or drag & drop files here</p>
                            <p style="color: #94a3b8; font-size: 0.9rem;">Supports: JPG, PNG, GIF, MP4, MOV (Max 10MB per file)</p>
                        `;
                        loadMediaLibrary();
                    } else {
                        alert('Upload failed: ' + (result.error || 'Unknown error'));
                    }
                } catch (error) {
                    alert('Upload error: ' + error.message);
                }
            });

            // Social post form
            document.getElementById('socialPostForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const formData = new FormData(this);
                const platforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked')).map(cb => cb.value);

                const postData = {
                    content: formData.get('content'),
                    media: formData.get('media'),
                    platforms: platforms
                };

                try {
                    const response = await fetch('/create-social-post', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(postData)
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert('Post created successfully!');
                        this.reset();
                        loadRecentPosts();
                    } else {
                        alert('Post failed: ' + (result.error || 'Unknown error'));
                    }
                } catch (error) {
                    alert('Post error: ' + error.message);
                }
            */
        });

        // Simple direct initialization
        console.log('Direct initialization...');
        // Note: Media and social content is now hardcoded in HTML
    </script>
</body>
</html>
